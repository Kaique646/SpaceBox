<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>

	<head>
		<meta charset="UTF-8">
		<title>SpaceBox</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet">
		<style>
      body {
        font-family: 'Open Sans', sans-serif;
        background-color: #333;
      }
        label{
        color: #fff;
      }

      .navbar {
        background-color: #2D3142;
      }

      .navbar-brand img {
        display: inline-block;
        vertical-align: middle;
      }

      .navbar-brand span {
        display: inline-block;
        vertical-align: middle;
        margin-left: 8px;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .nav-link {
        font-size: 1.1rem;
        font-weight: 600;
        color: white;
      }

      .hero {
        background-image: url("https://cdn.pixabay.com/photo/2019/08/08/15/00/space-4397146_960_720.jpg");
        background-size: cover;
        background-position: center;
        padding: 120px 0;
        text-align: center;
        color: #fff;
      }

      .hero-title {
        font-size: 3rem;
        font-weight: 600;
      }

      .hero-description {
        font-size: 1.5rem;
        margin-bottom: 40px;
      }

      .hero-cta {
        font-size: 1.2rem;
        font-weight: 600;
        padding: 16px 32px;
        border-radius: 30px;
      }

      .hero-cta:hover {
        color: #fff;
        background-color: #EA526F;
      }

      .footer {
        background-color: #2D3142;
        padding: 16px 0;
        color: #fff;
        text-align: center;
        position: absolute;
        bottom: 0;
        width: 100%;
      }

      .footer p {
        font-size: 0.9rem;
        margin: 0;
      }

      @media (max-width: 767px) {
        .navbar-brand img {
          width: 24px;
          height: 24px;
        }

        .navbar-brand span {
          font-size: 1.2rem;
        }

        .nav-link {
          font-size: 1rem;
        }

        .hero {
          padding: 80px 0;
        }

        .hero-title {
          font-size: 2.5rem;
        }

        .hero-description {
          font-size: 1.3rem;
          margin-bottom: 32px;
        }

        .hero-cta {
          font-size: 1.1rem;
          padding: 12px 24px;
        }
        .container-fluid {
  max-width: 800px;
}

.form-group label {
  font-weight: bold;
  margin-bottom: 0.5rem;
}

.form-group input[type="text"],
.form-group input[type="number"],
.form-group input[type="date"] {
  width: 100%;
  padding: 0.375rem 0.75rem;
  border: 1px solid #ced4da;
  border-radius: 0.25rem;
  font-size: 1rem;
  line-height: 1.5;
}

.form-group input[type="text"]:focus,
.form-group input[type="number"]:focus,
.form-group input[type="date"]:focus {
  border-color: #80bdff;
  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.form-group input[type="submit"] {
  background-color: #007bff;
  border-color: #007bff;
  color: #fff;
  cursor: pointer;
  padding: 0.375rem 0.75rem;
  font-size: 1rem;
  line-height: 1.5;
  border-radius: 0.25rem;
}

.form-group input[type="submit"]:hover {
  background-color: #0069d9;
  border-color: #0062cc;
}

.form-group input[type="submit"]:focus {
  outline: none;
  box-shadow: 0 0 0 0.2rem rgba(38, 143, 255, 0.5);
}

.form-group p {
  margin-bottom: 1.5rem;
}




      }
    		</style>
		</head>
	<body>
	<nav class="navbar navbar-expand-md navbar-dark bg-dark">
		<div class="container-fluid">
			<a class="navbar-brand" href="javascript:void(0)">
				<img
					src="https://media.istockphoto.com/id/1338320583/pt/foto/launching-rocket-on-blue-sky-background-startup-and-exploration-concept-3d-rendering.jpg?s=1024x1024&w=is&k=20&c=GEL1Kv4FRr7o4kG_mge_GvDamr8EDiltmoWIwL277BU="
					style="border-radius: 50%;" width="30" height="30" alt="SpaceBox Logo">
				<span><a class="nav-link" href="/">SpaceBox</a></span>
			</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mynavbar">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="mynavbar">
				<ul class="navbar-nav ms-auto">
					<li class="nav-item">
						<a class="nav-link" href="/viagem/create">Cadastro de Viagens</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/viagem/list">Lista de Viagens</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<section class="hero">
		<div class="container">
			<h1 class="hero-title">Preencha as informações abaixo:</h1>

		</div>
	</section>
	<div class="container-fluid">
		<form method="post" action="/viagem/create" id="frmViagem" onsubmit="salvar();">
			<div class="form-group">
				<label for="dtoDecolagem">Data da decolagem</label>
				<input type="date" class="form-control" id="dtoDecolagem" name="dtoDecolagem">
			</div>
			<div class="form-group">
				<label for="estadia">Duração da estadia em marte</label>
				<div class="input-group">
					<input type="number" class="form-control" id="estadia" name="estadia" min="1" step="1" required>
					<div class="input-group-append">
						<span class="input-group-text">dias</span>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label for="assentos">Quantidade de assentos disponíveis na nave</label>
				<input type="number" class="form-control" id="assentos" name="assentos" min="3" step="3">
			</div>
			<div class="form-group">
				<label for="modeloNave">Nome do modelo da nave</label>
				<input type="text" class="form-control" id="modeloNave" name="modeloNave" maxlength="9">
			</div>
			<div class="form-group">
				<label for="primeiroComandante">Nome do primeiro comandante</label>
				<input type="text" class="form-control" id="primeiroComandante" name="primeiroComandante" required>
			</div>
			<div class="form-group">
				<label for="matriculaPrimeiro">Matricula do primeiro comandante</label>
				<input type="text" class="form-control" id="matriculaPrimeiro" name="matriculaPrimeiro" maxlength="12"
					   oninput="formatarMatricula(this)">
			</div>
			<div class="form-group">
				<label for="segundoComandante">Nome do segundo comandante</label>
				<input type="text" class="form-control" id="segundoComandante" name="segundoComandante" required>
			</div>
			<div class="form-group">
				<label for="matriculaSegundo">Matricula do segundo comandante</label>
				<input type="text" class="form-control" id="matriculaSegundo" name="matriculaSegundo" maxlength="12"
					   oninput="formatarMatricula(this)">
			</div>
			<input type="hidden" name="dtoRetorno" id="dtoRetorno">
			<button type="submit" class="btn btn-primary">Salvar</button>
		</form>
	</div>

	<footer class="footer">
		<div class="container">
			<p>© 2023 SpaceBox. Todos os direitos reservados.</p>
		</div>
	</footer>



	</body>

</html>

<script>

	let responseEntity;

	function salvar(){ 
		  const dtoDecolagem = new Date(document.getElementById("dtoDecolagem").value);
		  const estadia = parseInt(document.getElementById("estadia").value);

		  const tempo_total = 2 * 260 + estadia;

		  const timestamp_retorno = dtoDecolagem.getTime() + tempo_total * 24 * 60 * 60 * 1000;
		  const dtoRetorno = new Date(timestamp_retorno).toISOString().split("T")[0];

		  document.getElementById("dtoRetorno").value = dtoRetorno;

		  const form = document.getElementById("frmViagem");
		  const formData = new FormData(form);
		  const jsonBody = JSON.stringify(Object.fromEntries(formData.entries()));
		  const header = new Headers();
		  header.append("Content-Type", "application/json");
		  
		  const requestOption ={
		      method: 'POST',
		      headers: header,
		      body: jsonBody
		  };
		  fetch('/viagem/create', requestOption)
		  .then(response => {
		    responseEntity = response;
		    return response.json();
		  })
		  .then(data => tratarRedirect(data))
		  .catch(error => console.log(error));
		}

	
	function tratarRedirect(data) {
		if(responseEntity.ok){
			alert('Produto cadastrado com sucesso');
			window.location.href = '/produto';
			return;
		}
		
		let listErros = document.getElemenyBydUd('erros');
		listErros.innerHTML = '';
		let itemListError = '';
		
		if(data.hasOwnProperty('nome'))
			itemListError = `<li class='text-danger'>${data.nome}</li>`;
			
		if(data.hasOwnProperty('idFornecedor'))
			itemListError = `<li class='text-danger'>${data.idFornecedor}</li>`;
			
		listErrors.innerHTML = itemListError;
		
	}
	
	
	function validateInput() {
	      var input = document.getElementById("input").value;
	      if (input % 3 != 0) {
	        alert("Por favor, digite um número múltiplo de 3.");
	        return false;
	      }
	      return true;
	      
	      var input = document.getElementById("estadia").value;
	      if (input <= 0 || !Number.isInteger(Number(input))) {
	        alert("Por favor, digite um número inteiro positivo.");
	        return false;
	      }
	      return true;
	      
	    }
	
	function formatarMatricula(input) {
		  const semHifen = input.value.replace(/[^A-Za-z0-9]/g, '');
		  
		  const formatado = semHifen.slice(0, 3) + '-' + semHifen.slice(3, 7) + '-' + semHifen.slice(7);
		  
		  input.value = formatado;
		}
	

	const modeloNaveInput = document.getElementById("modeloNave");


	modeloNaveInput.addEventListener("input", function() {
  const modeloNaveValue = modeloNaveInput.value;
  const modeloNaveRegex = new RegExp("[a-z]{4}-\\d{4}");
  if (!modeloNaveRegex.test(modeloNaveValue)) {
    modeloNaveInput.setCustomValidity("Formato de modelo inválido! Formato correto é aaaa-9999, onde a são" +
    		"letras de a-z e 9 representam números de 0 a 9");
  } else {
    modeloNaveInput.setCustomValidity("");
  }

  if (modeloNaveValue.length === 4 && !modeloNaveValue.endsWith("-")) {
    modeloNaveInput.value = modeloNaveValue + "-";
  }
  
});


			
</script>